// RP2040 MCU Platform Description for Renode
// Based on: https://github.com/matgla/Renode_RP2040
// Simplified version for NeuroForge blink test

using "platforms/cpus/cortex-m0plus.repl"

cpu0: CPU.CortexM @ sysbus
    cpuType: "cortex-m0+"
    numberOfMPURegions: 8
    
cpu1: CPU.CortexM @ sysbus
    cpuType: "cortex-m0+"
    numberOfMPURegions: 8

sram0: Memory.MappedMemory @ sysbus 0x20000000
    size: 0x42000

sram1: Memory.MappedMemory @ sysbus 0x20040000
    size: 0x1000

sram2: Memory.MappedMemory @ sysbus 0x20041000
    size: 0x1000

sram3: Memory.MappedMemory @ sysbus 0x20042000
    size: 0x1000

sram4: Memory.MappedMemory @ sysbus 0x20043000
    size: 0x1000

sram5: Memory.MappedMemory @ sysbus 0x20044000
    size: 0x1000

flash: Memory.MappedMemory @ sysbus 0x10000000
    size: 0x200000

rom: Memory.MappedMemory @ sysbus 0x00000000
    size: 0x4000

// UART0
uart0: UART.PL011 @ sysbus 0x40034000
    -> nvic@20

// UART1  
uart1: UART.PL011 @ sysbus 0x40038000
    -> nvic@21

// GPIO
sio: Miscellaneous.RP2040_SIO @ {
        sysbus 0xD0000000;
        sysbus new Bus.BusMultiRegistration { address: 0x40014000; size: 0x1000; region: "gpio" }
    }
    cpu0: cpu0
    cpu1: cpu1

// NVIC
nvic: IRQControllers.NVIC @ sysbus 0xE000E000
    priorityMask: 0xC0
    systickFrequency: 125000000
    IRQ -> cpu0@0

// Timer
timer: Timers.RP2040_Timer @ sysbus 0x40054000
    -> nvic@0
    -> nvic@1
    -> nvic@2  
    -> nvic@3

// Watchdog
watchdog: Timers.RP2040_Watchdog @ sysbus 0x40058000
    frequency: 1000000

// Resets
resets: Miscellaneous.RP2040_RESETS @ sysbus 0x4000C000

// PSM (Power State Machine)
psm: Miscellaneous.RP2040_PSM @ sysbus 0x40010000

// PLL
pllSys: Miscellaneous.RP2040_PLL @ sysbus 0x40028000

pllUsb: Miscellaneous.RP2040_PLL @ sysbus 0x4002C000

// XIP (Execute-in-Place)
xip: Miscellaneous.RP2040_XIP_Ctrl @ sysbus 0x14000000
    flash: flash

// SSI (Synchronous Serial Interface)
ssi: SPI.RP2040_SSI @ sysbus 0x18000000
    flash: flash

// Clocks
clocks: Miscellaneous.RP2040_Clocks @ sysbus 0x40008000
    pllSys: pllSys
    pllUsb: pllUsb
